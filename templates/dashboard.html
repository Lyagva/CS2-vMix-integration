<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>CS2 Dashboard</title>
  <!-- Tailwind CSS via CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Configure Tailwind dark mode -->
  <script>
    tailwind.config = {
      darkMode: 'class',
    }
  </script>
</head>
<body class="bg-gray-900 text-white">
  <div class="container mx-auto p-4">
    <h1 class="text-3xl font-bold mb-6">CS2 Dashboard</h1>

    <!-- Game Info Cards -->
    <div id="gameInfo" class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-8">
      <!-- Map Info Card -->
      <div class="bg-gray-800 rounded-lg shadow p-4">
        <h2 class="text-xl font-semibold mb-2">Map Info</h2>
        <p><strong>Name:</strong> <span id="mapName">Loading...</span></p>
        <p><strong>Round Phase:</strong> <span id="roundPhase">Loading...</span></p>
        <p><strong>Round Number:</strong> <span id="roundNumber">Loading...</span></p>
      </div>

      <!-- Team Scores Card -->
      <div class="bg-gray-800 rounded-lg shadow p-4">
        <h2 class="text-xl font-semibold mb-2">Team Scores</h2>
        <p><strong>CT Score:</strong> <span id="teamCTScore">Loading...</span></p>
        <p><strong>T Score:</strong> <span id="teamTScore">Loading...</span></p>
      </div>
    </div>

    <!-- Players Section -->
    <div id="playersSection">
      <h2 class="text-2xl font-semibold mb-4">Players</h2>
      <!-- Two columns: one for CT and one for T -->
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <!-- CT Team Column -->
        <div id="ctContainer" class="space-y-4">
          <h3 class="text-xl font-bold">CT</h3>
          <!-- CT player cards will be inserted here -->
        </div>
        <!-- T Team Column -->
        <div id="tContainer" class="space-y-4">
          <h3 class="text-xl font-bold">T</h3>
          <!-- T player cards will be inserted here -->
        </div>
      </div>
    </div>
  </div>

  <script>
    // Function to create a player card element
    function createPlayerCard(playerId, playerData) {
      const card = document.createElement('div');
      card.className = 'bg-gray-800 rounded-lg shadow p-4';

      // Header: Player Name & Team
      const header = document.createElement('div');
      header.className = 'mb-2';
      header.innerHTML = `
        <h3 class="text-xl font-bold">${playerData.name || 'Unknown'}</h3>
        <p class="text-sm text-gray-400">Team: ${playerData.team || 'N/A'}</p>
      `;
      card.appendChild(header);

      // Match Stats
      const matchStats = playerData.match_stats || {};
      const statsDiv = document.createElement('div');
      statsDiv.className = 'mb-2';
      statsDiv.innerHTML = `
        <p><strong>Kills:</strong> ${matchStats.kills ?? 'N/A'}</p>
        <p><strong>Deaths:</strong> ${matchStats.deaths ?? 'N/A'}</p>
        <p><strong>Assists:</strong> ${matchStats.assists ?? 'N/A'}</p>
        <p><strong>MVPs:</strong> ${matchStats.mvps ?? 'N/A'}</p>
        <p><strong>Score:</strong> ${matchStats.score ?? 'N/A'}</p>
      `;
      card.appendChild(statsDiv);

      // Player State: Health, Armor, Money, etc.
      const state = playerData.state || {};
      const stateDiv = document.createElement('div');
      stateDiv.className = 'mb-2';
      stateDiv.innerHTML = `
        <p><strong>Health:</strong> ${state.health ?? 'N/A'}</p>
        <p><strong>Armor:</strong> ${state.armor ?? 'N/A'}</p>
        <p><strong>Money:</strong> ${state.money ?? 'N/A'}</p>
      `;
      card.appendChild(stateDiv);

      // Weapons List
      const weapons = playerData.weapons || {};
      const weaponNames = Object.values(weapons)
        .map(weapon => weapon.name)
        .filter(name => name) // Filter out empty or undefined names
        .join(', ') || 'None';
      const weaponsDiv = document.createElement('div');
      weaponsDiv.innerHTML = `<p><strong>Weapons:</strong> ${weaponNames}</p>`;
      card.appendChild(weaponsDiv);

      return card;
    }

    // Function to fetch and update the dashboard data
    function updateData() {
      fetch('/data')
        .then(response => response.json())
        .then(data => {
          // Update Map Info & Team Scores
          if (data.map) {
            document.getElementById('mapName').innerText = data.map.name || 'N/A';
            document.getElementById('roundNumber').innerText = data.map.round || 'N/A';
            if (data.round) {
              document.getElementById('roundPhase').innerText = data.round.phase || 'N/A';
            }
            if (data.map.team_ct) {
              document.getElementById('teamCTScore').innerText = data.map.team_ct.score || 'N/A';
            }
            if (data.map.team_t) {
              document.getElementById('teamTScore').innerText = data.map.team_t.score || 'N/A';
            }
          }

          // Clear previous player cards and re-add headers
          const ctContainer = document.getElementById('ctContainer');
          const tContainer = document.getElementById('tContainer');
          ctContainer.innerHTML = '<h3 class="text-xl font-bold">CT</h3>';
          tContainer.innerHTML = '<h3 class="text-xl font-bold">T</h3>';

          // Separate players by team and create cards for each
          if (data.allplayers) {
            Object.entries(data.allplayers).forEach(([playerId, playerData]) => {
              const card = createPlayerCard(playerId, playerData);
              if (playerData.team === 'CT') {
                ctContainer.appendChild(card);
              } else if (playerData.team === 'T') {
                tContainer.appendChild(card);
              }
            });
          }
        })
        .catch(error => {
          console.error('Error fetching data:', error);
        });
    }

    // Poll for new data every second
    setInterval(updateData, 1000);
    // Initial fetch when the page loads
    updateData();
  </script>
</body>
</html>
